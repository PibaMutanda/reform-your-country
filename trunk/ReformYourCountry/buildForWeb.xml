<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project>
<project name="reform-your-country" default="war" basedir=".">
	<property file="build.properties" />
	<property environment="env" />

	<path id="classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${env.TOMCAT_HOME}">
					<include name="*.jar" />
		</fileset>
	</path>
	

	<!-- convert classpath to a flat list/string for use in manifest/debug task -->
	<pathconvert property="mf.classpath" pathsep=";">
		<path refid="classpath" />
		<flattenmapper />
	</pathconvert>

	<target name="init" description="Perform some init task" depends="clean">
		<tstamp />
		<mkdir dir="${build.dir}" />
		<manifest file="MANIFEST.MF">
			<attribute name="Built-By" value="${manifest.built.by}" />
			<attribute name="Created-By" value="${manifest.created.by}" />
			<attribute name="Main-Class" value="${manifest.main.class}" />
			<attribute name="Implementation-Version" value="${version.number}-b${build.number}" />
			<attribute name="Built-Date" value="${TODAY}" />
			<attribute name="Class-Path" value="${mf.classpath}" />
		</manifest>
	</target>

	<target name="compile" description="compile the source" depends="init">
		<echo message="Building ${app.name} ..." />
		<javac srcdir="${src.dir}" destdir="${build.dir}" debug="on" classpathref="classpath">
			<exclude name="**/test/**" />
		</javac>
		
	</target>
	<target name="war" depends="compile">
		<echo message="Making war file ..." />
		<copy todir="build/classes" includeEmptyDirs="no">
		            <fileset dir="src/">
		            <patternset>
		                <include name="**/*.properties"/>
		                <include name="**/*.xml"/>
		            </patternset>
		            </fileset>
			</copy>
		<war destfile="dist/ReformYourCountry.war" webxml="WebContent/WEB-INF/web.xml">
			<fileset dir="WebContent"/>
			<lib dir="WebContent/WEB-INF/lib"/>
			<classes dir="build/classes"/>
		</war>
	</target>
    <!--TODO make war instead of jar-->
	<!--<target name="jar" depends="compile" description="CrÃ©er un jar contenant seulement les classes normales (pas celles de test)">
		<echo message="making the jar"/>
		<mkdir dir="${build.dir}/lib" />
		<jar jarfile="${build.dir}/lib/${app.name}.jar" basedir="${build.dir}" includes="**" excludes="test/**"/>
	</target>-->




	<target name="clean" description="clean up">
		<echo message="cleanings..."/>
		<delete dir="${build.dir}" />
	</target>

	<target name="debug" description="Lists the properties for debugging purposes">
		<echo message="Lists the properties for debugging purposes ..." />
		<echo message="ant.version                    = ${ant.version}" />
		<echo message="ant.home                       = ${ant.home}" />
		<echo message="java.home                      = ${env.JAVA_HOME}" />
		<echo message="" />
		<echo message="type                           = ${type}" />
		<echo message="version                        = ${version}" />
		<echo message="app.name                       = ${app.name}" />
		<echo message="basedir                        = ${basedir}" />
		<echo message="lib.dir                        = ${lib.dir}" />
		<echo message="build.dir                      = ${build.dir}" />
		<echo message="classpath                      = ${mf.classpath}" />
	</target>

</project>